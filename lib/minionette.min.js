// Backbone.Minionette
// -------------------
// v0.5.1
//
// Copyright (c)2013 Justin Ridgewell
// Distributed under MIT license
//
// https://github.com/jridgewell/minionette

var Minionette=function(e,i,t,n){"use strict";var s={};return n.Minionette=s,function(e){if(e){var t=e.cleanData,n=e("<span />"),s=!0;n.on("remove",function(){s=!1}),n.remove(),s&&(e.cleanData=function(n){i.each(n,function(i){try{e(i).triggerHandler("remove")}catch(t){}}),t(n)})}}(jQuery),s.View=n.View.extend({constructor:function(e){e||(e={}),this._ensureRegion(e),this._initializeRegions(e),i.bindAll(this,"_jqueryRemove","_viewHelper"),n.View.apply(this,arguments),this._listenToEvents(this.model,i.result(this,"modelEvents")),this._listenToEvents(this.collection,i.result(this,"collectionEvents"))},template:function(){return""},serialize:function(){return{}},_serialize:function(){return i.extend({view:this._viewHelper},this.serialize())},delegateEvents:function(){s.View.__super__.delegateEvents.apply(this,arguments),this.$el.on("remove.delegateEvents"+this.cid,this._jqueryRemove)},remove:function(){this._isRemoving||(this._isRemoving=!0,this.trigger("remove"),this._removeFromParent(),i.invoke(this._regions,"remove"),s.View.__super__.remove.apply(this,arguments),delete this._jqueryRemove,delete this._viewHelper,this.unbind())},render:function(){return this.trigger("render"),i.invoke(this._regions,"detach"),this.$el.html(this.template(this._serialize())),i.invoke(this._regions,"reattach"),this},addRegion:function(e,i){var t=new this.Region({view:i});return this._regions[e]&&this._regions[e].remove(),t.name=e,t._parent=this,this[e]=this._regions[e]=t,t},addRegions:function(e){i.each(e,function(e,i){this.addRegion(i,e)},this)},_removeFromParent:function(){this._parent&&this._parent._removeView&&this._parent._removeView(this),this._parent=null},_removeRegion:function(e){this._regions[e.name]&&(delete this[e.name],delete this._regions[e.name])},_jqueryRemove:function(){this.trigger("remove:jquery"),this.remove()},_listenToEvents:function(e,t){e&&i.each(t,function(t,n){i.isFunction(t)||(t=this[t]),this.listenTo(e,n,t)},this)},_ensureRegion:function(e){this.Region=e.Region||this.Region||s.Region},_initializeRegions:function(e){this._regions={};var t=i.result(this,"regions");e.regions&&(t=e.regions),this.addRegions(t)},_viewHelper:function(e){var i=this._regions[e];return i?i.render().el.outerHTML:""}}),s.Region=function(e){this.cid=i.uniqueId("region"),this._ensureView(e||{})},s.Region.extend=n.View.extend,i.extend(s.Region.prototype,n.Events,{View:s.View.extend({tagName:"span",attributes:function(){return{"data-cid":this.cid}}}),_ensureView:function(e){this._view=new this.View,e.view&&(this.view=e.view),this.view instanceof n.View||(this.view=this._view),this._assignParent(this.view)},reset:function(e){this.attach(this._view,e)},render:function(){return this.view.render()},attach:function(e,i){this._assignParent(e);var t=this.view;return this.view.$el.after(e.$el),this.view.$el.detach(),this.view=e,i||t.remove(),e},remove:function(){this._removeViews(),this._removeFromParent()},_removeViews:function(){this.view.remove(),this._view.remove(),this._detachedView&&this._detachedView.remove()},_removeFromParent:function(){this._parent&&this._parent._removeRegion&&this._parent._removeRegion(this),this._parent=null},detach:function(){return this._detachedView&&this._detachedView.remove(),this._detachedView=this.view,this.view!==this._view&&this.reset(!0),this},reattach:function(){if(this._detachedView){var e=this._parent&&this._parent.$el||n.$(document.body),i="[data-cid="+this.view.cid+"]",t=this._detachedView;return e.find(i).replaceWith(t.$el),delete this._detachedView,this.view=t,t}},_removeView:function(e){this.view===e&&this.reset(!0)},_assignParent:function(e){e._parent=this}}),s.ModelView=s.View.extend({modelEvents:{change:"render",destroy:"remove"},serialize:function(){return this.model.attributes}}),s.CollectionView=s.View.extend({constructor:function(e){this._modelViews={},this._ensureModelView(e||{}),s.View.apply(this,arguments),this.listenTo(this,"remove",this._removeModelViews)},collectionEvents:{add:"addOne",remove:"removeOne",reset:"render",sort:"render"},render:function(){this.trigger("render"),this._removeModelViews();var e=this.$el.html(this.template(this._serialize()));return this.$el=t(document.createDocumentFragment()),this.collection.each(this._addModelView,this),this.$el=e.append(this.$el),this},addOne:function(e){this.trigger("addOne");var i=this._addModelView(e);return i},removeOne:function(e){this.trigger("removeOne");var t=i.findWhere(this._modelViews,{model:e});return t&&t.remove(),t},_addModelView:function(e){var i=new this.ModelView({model:e});return this._modelViews[i.cid]=i,i._parent=this,this.$el.append(i.render().$el),i},_removeView:function(e){delete this._modelViews[e.cid]},_removeModelViews:function(){i.invoke(this._modelViews,"remove")},_ensureModelView:function(e){this.ModelView=e.ModelView||this.ModelView||s.ModelView}}),s}(this,_,jQuery,Backbone);
//@ sourceMappingURL=lib/minionette.map