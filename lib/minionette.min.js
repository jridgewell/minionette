// Backbone.Minionette
// -------------------
// v0.3.0
//
// Copyright (c)2013 Justin Ridgewell
// Distributed under MIT license
//
// https://github.com/jridgewell/minionette

var Minionette=function(e,i,t,n){"use strict";var r={};return n.Minionette=r,function(e){if(e){var t=e.cleanData,n=e("<span />"),r=!0;n.on("remove",function(){r=!1}),n.remove(),r&&(e.cleanData=function(n){i.each(n,function(i){try{e(i).triggerHandler("remove")}catch(t){}}),t(n)})}}(jQuery),r.Region=function(e){this.cid=i.uniqueId("subview"),e&&e.view&&(this.view=e.view),this._ensureView()},r.Region.extend=n.View.extend,i.extend(r.Region.prototype,n.Events,{_View:n.View.extend({tagName:"span",attributes:function(){return{"data-cid":this.cid}}}),_ensureView:function(){this._view=new this._View,this.view instanceof n.View||(this.view=this._view),this._assignParent(this.view)},reset:function(){this.attach(this._view)},render:function(){return this.view.render()},attach:function(e){return this._assignParent(e),this.view.$el.after(e.$el),this.view.$el.detach(),this.view=e,e},remove:function(){var e=this.view;return this.reset(),e.remove(),e},detach:function(){return this._detachedView=this.view,this.reset(),this},reattach:function(){if(this._detachedView){var e=this._parent&&this._parent.$el||n.$(document.body),i="[data-cid="+this.view.cid+"]",t=this._detachedView;return e.find(i).replaceWith(t.$el),delete this._detachedView,this.view=t,t}},_removeView:function(e){this.view===e&&this.reset()},_assignParent:function(e){e._parent=this}}),r.View=n.View.extend({constructor:function(e){this._initializeRegions(e||{}),i.bindAll(this,"_jqueryRemove","_viewHelper"),n.View.apply(this,arguments),this._listenToEvents(this.model,i.result(this,"modelEvents")),this._listenToEvents(this.collection,i.result(this,"collectionEvents"))},Region:r.Region,template:function(){return""},serializeData:function(){return{}},_serializeData:function(){return i.extend({view:this._viewHelper},this.serializeData())},delegateEvents:function(){r.View.__super__.delegateEvents.apply(this,arguments),this.$el.on("remove.delegateEvents"+this.cid,this._jqueryRemove)},remove:function(){this._isRemoving||(this._isRemoving=!0,this.trigger("remove:before"),this._removeFromParent(),i.invoke(this._regions,"remove"),r.View.__super__.remove.apply(this,arguments),this.trigger("remove"))},render:function(){return this.trigger("render:before"),i.invoke(this._regions,"detach"),this.$el.html(this.template(this._serializeData())),i.invoke(this._regions,"reattach"),this.trigger("render"),this},addRegion:function(e,i){var t=new this.Region({view:i});return t._parent=this,this[e]=this._regions[e]=t,t},_removeFromParent:function(){this._parent&&this._parent._removeView&&(this._parent._removeView(this),this._parent=null)},_jqueryRemove:function(){this.trigger("remove:jquery"),this.remove()},_listenToEvents:function(e,t){e&&i.each(t,function(t,n){i.isFunction(t)||(t=this[t]),this.listenTo(e,n,t)},this)},_initializeRegions:function(e){this._regions={};var t=i.result(this,"regions");e.regions&&(t=e.regions),i.each(t,function(e,i){this.addRegion(i,e)},this)},_viewHelper:function(e){var i=this._regions[e];return i?i.render().el.outerHTML:""}}),r.ModelView=r.View.extend({modelEvents:{change:"render",destroy:"remove"},serializeData:function(){return this.model.attributes}}),r.CollectionView=r.View.extend({ModelView:n.View,collectionEvents:{add:"addOne",remove:"removeOne",reset:"render",sort:"render"},render:function(){this.trigger("render:before"),this._modelViews={};var e=this._getModelView(),i=this.$el.html(this.template(this._serializeData()));return this.$el=t(document.createDocumentFragment()),this.collection.each(function(i){this._addModelView(i,e)},this),this.$el=i.append(this.$el),this.trigger("render"),this},addOne:function(e){this.trigger("addOne:before");var i=this._getModelView(),t=this._addModelView(e,i);return this.trigger("addOne"),t},removeOne:function(e){this.trigger("removeOne:before");var i=this._findModelViewByModel(e);return i&&i.remove(),this.trigger("removeOne"),i},_addModelView:function(e,i){var t=new i({model:e});return this._modelViews||(this._modelViews={}),this._modelViews[t.cid]=t,t._parent=this,this.$el.append(t.render().$el),t},_getModelView:function(){var e=this.ModelView;return this.options&&this.options.ModelView&&(e=this.options.ModelView),e},_findModelViewByModel:function(e){return i.findWhere(this._modelViews,{model:e})}}),r}(this,_,jQuery,Backbone);
//@ sourceMappingURL=lib/minionette.map